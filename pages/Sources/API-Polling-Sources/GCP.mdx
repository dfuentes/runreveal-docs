---
description: Quickly ingest your GCP organization logs.
---
import { Callout } from 'nextra/components'

# Google Cloud Platform logs

GCP logs are ingested by routing your projects or organization logs to a storage bucket, 
and allowing RunReveal access (using a service account) to poll the bucket for new files every minute.

## Setup

Setting up this GCP source requires a few steps that will be detailed below.

1. Create a service account with a JSON key.
2. Create a storage bucket giving read access to the created service account.
3. Create a pub/sub topic that forwards events to the storage bucket.
4. Setup log router to send logs to the created pub/sub topic.
5. Create a RunReveal GCP source and provide us with the details of your setup.

### 1. Service Account Creation

Choose a project that you would like the storage bucket, pub/sub topic, and service account to reside and switch to that project in the GCP Console.

Create a new service account (or use an existing one) by navigating to the service account creation page, https://console.cloud.google.com/iam-admin/serviceaccounts/create

Give the service account a name, id, and a description. Make sure to copy the generated service address email as it will be needed in a future step.

![gcp service account creation](/gcp-poll-1.png)

Once created, open the service account and navigate to the keys menu. Create a new JSON private key, this will be uploaded to RunReveal to allow access to your GCP resources.

![gcp service account key](/gcp-poll-2.png)

### 2. Storage Bucket Creation

Navigate to the GCP [cloud storage](https://console.cloud.google.com/storage/browser) page and create a new bucket.

Give the bucket a name (this will be used when adding the RunReveal source), and fill in the remaining settings based on your needs.

<Callout type="info">
  If adding a retention policy to the bucket, make sure its no less than 1 hour. 
  This will insure that RunReveal has sufficient time to import all of the logs before the object has been deleted.
</Callout>

Once the bucket is created, go to the permission settings for it and click on Grant Access. 
Add the email address for the service account that was created in step 1. And assign the `Storage Object Viewer` role to it.

![bucket permissions](/gcp-poll-3.png)

### 3. Pub/Sub Topic Setup

Navigate to the GCP [Pub/Sub](https://console.cloud.google.com/cloudpubsub/topic/list) setup page and create a new topic.

When creating a new topic, give it a name and you can remove the default subscription. 
Instead select `Backup message data to Cloud Storage`. Select the bucket that was created in step 2.
If GCP warns about missing permissions follow their instructions to grant them.
For the remaining settings, make sure to select `Text` as the file output and uncheck `Write metadata`. 
Prefix, suffix, and file batching can be set based on your needs, if setting prefix, make sure to make a note of what is set as that will be needed when setting up the RunReveal source.

![topic creation](/gcp-poll-4.png)

### 4. GCP Log Router Sink Setup

All of the pieces are now in place to send GCP logs to your storage bucket. Navigate to the GCP [Log router](https://console.cloud.google.com/logs/router) setup page to create a new sink.
You can setup a logging sink for a single project or your entire organization and forward logs to the bucket created in step 2.
This setup will take you through creating a sink for your organization. Create a new logging sink giving it a name, choose `Cloud Pub/Sub topic` as your sink destination
and select the option to use a topic in a project. It will have you supply the project ID that the topic was creating under, 
and the topic ID that were created in step 3. Add an optional inclusion or exclusion filter to limit the logs that are sent to the pub/sub topic.

![logging sink](/gcp-poll-5.png)

### 5. RunReveal GCP source

Now that you have all of the GCP pieces created you can add a [GCP source](https://runreveal.com/dash/sources/add/gcp) in RunReveal. 

Provide a name for the source and fill in the bucket name that was created in step 2. 
For the prefix field include any sub folder in the bucket the logs may be stored in and any file prefix that was added when setting up the pub/sub topic subscription.
Upload the credential file that was downloaded from step 1 or paste the contents from it into the credential field.

![rr source](/gcp-poll-6.png)

Verify your settings to make sure that RunReveal has access to list and read the objects in your bucket.

### 6. Ingest

Your GCP source is now setup and logs should start showing up in RunReveal within a couple of minutes. For additional questions, reach out to the RunReveal team for assistance.